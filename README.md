# colmap
在针对colmap处理上千张照片的问题中，提出几种有用的方法

前言：在做3DGS大规模场景方面，由于初始点云可从colmap中得到，而处理大规模自定义数据集，传统的colmap步骤会面临时间很长的问题，举个例子300张图像左右，直接建图大概耗时10分钟；600张图像左右，直接建图大概耗时30分钟；1400张图像左右，直接建图大概耗时540分钟。而本人面临一个六千多张照片的数据集时时间更是天文数字。故有以下方法，方法的优点与缺点一并写出，并给出方法的代码

1，传统的colmap的处理代码见，见colmap_tradition

2,在针对连续帧或者视频抽帧出来的图片可改用sequential_matcher，进行重建。代码见colamp_video，但此方法在处理几千张数据集时时间并未减少多少

3，与2相对，在处理大规模非序列数据可使用 vocab_tree_matcher 或 spatial_matcher 限定候选对，代码见colmap_non-sequential

4，当照片位于多个子文件夹，每个文件夹数量照片较多时，可尝试进行子文件夹独立重建再使用colmap_merged进行融合。代码见colmap_fuse,缺点：当子文件夹直接重回较少时，无法进行重建

5，由于当数据级过大时，在全局BA过程会消耗大量时间，故我们可以考虑先进行局部BA，再对结果进行全局BA。代码见colmap_part。但由于colmap本身限制Mapper.ba_global_max_num_iterations设置为0会报错无法运行，故设置10，最最终时长也较多

6，当照片彼此之间重合度较高，我们可考虑进行采样重建，采样后数量可参考前言里面所言.本代码设置为1200张，代码见colmap_sampling

7,图像特别多时也可考虑分段建图，但此方法效果一般，可能是由于拍摄时运动模糊太大导致，官方文档推荐在执行完分段建图后最好还额外执行几轮三角化和全局BA。代码见colmap_seg

代码中SOURCE_DIR为源图片所在位置，TARGET_DIR=为处理后图片所在位置（如不需要可不管），COLMAP_WORKSPACE为colmap处理后结果所在位置。以上7种方法并非相互独立，可进行相互结合。
